#!/bin/sh

program=$1
desktopfile="/usr/share/applications/${program}.desktop"
mimeappsfile="${HOME}/.local/share/applications/mimeapps.list"

if [ ! -f $desktopfile ]; then
    echo "Could not find or not a regular file: ${desktopfile}"
    exit 1
fi

echo "Reading ${desktopfile}..."
echo
echo "---------------------------------"
mimeline=$(grep '^MimeType' ${desktopfile})
echo $mimeline
mimes=${mimeline#*=}
echo "---------------------------------"
echo $mimes
mimeArr=${mimes//;/ }
echo "---------------------------------"

echo
echo "Does this look good?"
echo

echo "[Removed Associations]"
for mime in $mimeArr
do
    echo "${mime}=${program}.desktop"
done


echo
read -p "Commit to ${mimeappsfile}?[y/n] " -r

if [[ ! $REPLY =~ ^[Yy]$ ]]
then
    exit 1
fi

echo >> ${mimeappsfile}
echo "# The following was written by $0" >> ${mimeappsfile}
echo "[Removed Associations]" >> ${mimeappsfile}
for mime in $mimeArr
do
    echo "${mime}=${program}.desktop" >> ${mimeappsfile}
done
echo "# End of mime data generated by $0" >> ${mimeappsfile}
